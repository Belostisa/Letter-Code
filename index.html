<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Encrypted Letter</title>
  <link rel="stylesheet" href="style3.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

  <!-- FULL BACKGROUND VIDEO -->
  <div class="bg-video">
    <video autoplay muted loop playsinline>
      <source src="media/bg.mp4" type="video/mp4">
    </video>
  </div>
  
  <audio id="bgAudio" loop preload="auto" crossorigin="anonymous">
  <source src="media/sextape.mp3" type="audio/mpeg">
</audio>


  <!-- FLOWERS VIDEO (unchanged) -->
  <section class="flowers-section">
    <video autoplay muted loop playsinline class="flowers-video">
      <source src="media/flowers2.mp4" type="video/mp4">
    </video>
  </section>
  
<!-- WAVE OVERLAY (does NOT affect layout) -->
<div class="wave-overlay" id="waveOverlay" aria-hidden="true">
  <canvas id="waveCanvas"></canvas>
</div>

<!-- Optional: use your existing click-anywhere to start audio OR keep a button -->
<button class="wave-play" id="playWave" aria-label="Play">▶</button>

  <!-- WAVE (hidden until first click) -->
<section class="wave-wrap">
  <div class="wave-slot" id="waveSlot">
    <canvas id="waveCanvas"></canvas>
    <button class="neon-play" id="playWave" aria-label="Play">▶</button>
  </div>
</section>


  <!-- ENVELOPE SECTION (unchanged) -->
  <section class="envelope-section">
    <div class="envelope" onclick="openEmail()">
      <div class="envelope-back"></div>
      <div class="inbox-label">INBOX</div>
      <div class="envelope-flap"></div>
    </div>
  </section>

  <!-- EMAIL WINDOW (unchanged) -->
  <div class="email-overlay" id="emailOverlay">
    <div class="email-window">

      <div class="email-header">
        <span class="email-title">Inbox</span>
        <button class="email-close" onclick="closeEmail()">✕</button>
      </div>

      <div class="email-body" id="emailContent"></div>

      <div class="email-footer">
        <button onclick="prevPage()">◀ Prev</button>
        <span id="pageIndicator">1 / 3</span>
        <button onclick="nextPage()">Next ▶</button>
      </div>

    </div>
  </div>

<script>
const pages = [
`Hkls, q dYtZp FhEw yCjO uXnRzS PkLwO hAqMZ. RvTnO YZ qBHeF, kLZpVq, jF hLk OqTjM, fP XnO kLqF uPzM. HZJ nRkY, FhEw HZJ kPqRjTQ iLwPpU nXqZ TqJ FhEw HZJ YkLZQ pJwO hFZ uLkY, kLZpU yF TqJ, fP XnO hAqMZ.

VZJ pFZQ pJwO ZkLwZV hFZ pJZ. Y nOZ kFZ YZpFZL FhZQ, kLZQ HZJ nFZ pRkYpJYh, ZLZpZrZP FhZQ QJpFZ. Y RkZ ZL, FhZQ Y TqJ Y pFZqRZ FhZQ Y pJZL. ZPZ FhZQ pJwO hZJZL YZ uPZpQZ, FhZQ ZkLZQJ pJZ pJZL uFZQ pJZL Y nOZ YZ.

RvTnO, FhZQ ZLZLZP FhZQ pJZ QJwFZ, nOZkZ YZ pJZLZ. Y QZLZ, FhZQ YZ OqFZ pFZpZLZ FhZQ QZLZLZ, nOZkZ QZLZLZ. TqJ, qJZ pZLZLZ FhZQ pFZLZ pJZL, ZPZ nOZ ZPZLZ ZkLZQZ QZLZ. HZ pZLZLZ Y nOZ pJZL.`,

`Y nOZLZ, pZLZQ pZLZLZ pJZLZ pFZQ. nOZkZ, ZkZ pFZLZ pZLZLZ, pZLZLZ ZLZLZ ZPZ. Y pFZLZ FhZQ pZLZQ ZkZLZLZ, Y pFZLZ nOZ ZLZ. Np Y pFZLZ nOZ ZkLZ pZLZLZ, FhZQ ZPZ nOZpZLZ, pFZLZ nOZ pJZLZ.

Y nOZLZLZ, FhZQ ZkZLZLZ pZLZ pJZLZ, nOZ ZLZLZ pFZLZ pZLZLZ, Y ZLZLZ ZPZ ZLZLZ ZPZ. FhZQ kZpZLZ pZLZLZ pFZLZ pZLZLZ nOZ ZkZLZ pZLZLZ pFZLZ pZLZLZ. V nOZLZLZ kZ pZLZ. Y pZLZLZ ZkZLZLZ ZPZ ZPZLZLZ. ZPZ pZLZLZ pZLZLZ ZPZ, Y pFZLZ pZLZ.
`,

`RZLZLZ, nOZ pZLZLZ pJZLZ ZkZLZLZ pZLZLZ. Y nOZLZLZ Y nOZ ZPZ ZPZ nOZ pZLZLZ FhZQ pZLZLZ. FhZQ ZPZ pZLZLZ nOZ ZPZ, FhZQ ZPZ pZLZLZ. ZPZ pZLZLZ pZLZLZ pZLZLZ Y ZkZLZLZ, Y ZPZ pZLZLZ ZPZ ZPZ pZLZLZ.

Y pFZLZ pZLZLZ, FhZQ pZLZLZ pZLZLZ ZkZLZLZ ZPZ pZLZLZ ZPZ pZLZLZ. FhZQ ZkZLZLZ ZPZ pZLZLZ Y pZLZLZ pZLZLZ. ZPZ ZkZLZLZ Y ZkZLZLZ, ZPZ Y pFZLZ nOZ pZLZLZ.

Y pZLZLZ pZLZLZ FhZQ pZLZLZ, nOZ Y pZLZLZ ZkZLZLZ, FhZQ ZkZLZLZ pZLZLZ ZkZLZLZ Y pZLZLZ pZLZLZ ZPZ. nOZLZLZ, kZLZLZ ZkZLZLZ ZPZLZLZ nOZ pZLZLZ, Y pZLZLZ ZkZLZLZ Y pZLZLZ.
`
];

let currentPage = 0;

function openEmail() {
  document.querySelector(".envelope").classList.add("open");
  document.getElementById("emailOverlay").style.display = "flex";
  renderPage();
}

function closeEmail() {
  document.querySelector(".envelope").classList.remove("open");
  document.getElementById("emailOverlay").style.display = "none";
}

function renderPage() {
  document.getElementById("emailContent").textContent = pages[currentPage];
  document.getElementById("pageIndicator").textContent =
    `${currentPage + 1} / ${pages.length}`;
}

function nextPage() {
  if (currentPage < pages.length - 1) {
    currentPage++;
    renderPage();
  }
}

function prevPage() {
  if (currentPage > 0) {
    currentPage--;
    renderPage();
  }
}
/* -------------------------
   FULL-WIDTH WAVE OVERLAY
   - uses bgAudio
   - light blue, thicker, more movement
   - fixed overlay (no layout shift)
------------------------- */
const playBtn   = document.getElementById("playWave");
const audioEl   = document.getElementById("bgAudio");
const overlay   = document.getElementById("waveOverlay");
const canvas    = document.getElementById("waveCanvas");
const ctx       = canvas.getContext("2d", { alpha: true });

let audioCtx, analyser, srcNode, timeData, freqData;
let rafId = null;
let started = false;

function resizeCanvas(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  canvas.width  = Math.floor(canvas.clientWidth * dpr);
  canvas.height = Math.floor(canvas.clientHeight * dpr);
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

function setupAnalyser(){
  if (audioCtx) return;

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048;
  analyser.smoothingTimeConstant = 0.82;

  timeData = new Uint8Array(analyser.frequencyBinCount);
  freqData = new Uint8Array(analyser.frequencyBinCount);

  // Only create ONE MediaElementSource per <audio>
  srcNode = audioCtx.createMediaElementSource(audioEl);
  srcNode.connect(analyser);
  analyser.connect(audioCtx.destination);
}

const clamp = (v,a,b)=>Math.min(b,Math.max(a,v));
const lerp  = (a,b,t)=>a+(b-a)*t;

let rmsSmooth = 0;
let trebleSmooth = 0;

function readAudio(){
  if (!analyser) return { level: 0, treble: 0 };

  analyser.getByteTimeDomainData(timeData);
  analyser.getByteFrequencyData(freqData);

  // RMS loudness
  let sum = 0;
  for (let i=0;i<timeData.length;i++){
    const v = (timeData[i]-128)/128;
    sum += v*v;
  }
  const rms = Math.sqrt(sum / timeData.length);
  rmsSmooth = lerp(rmsSmooth, rms, 0.09);

  // Treble energy (adds “electric” motion)
  let hi = 0;
  const start = Math.floor(freqData.length * 0.35);
  for (let i=start;i<freqData.length;i++) hi += freqData[i];
  const hiNorm = hi / ((freqData.length - start) * 255);
  trebleSmooth = lerp(trebleSmooth, clamp(hiNorm,0,1), 0.12);

  return { level: rmsSmooth, treble: trebleSmooth };
}

function strokeNeonBlue(drawPath){
  ctx.save();
  ctx.globalCompositeOperation = "lighter";

  // OUTER glow
  ctx.shadowColor = "rgba(120,220,255,0.18)";
  ctx.shadowBlur = 26;
  ctx.lineWidth = 8.0;                           // thick glow
  ctx.strokeStyle = "rgba(120,220,255,0.10)";
  drawPath(); ctx.stroke();

  // MID glow
  ctx.shadowColor = "rgba(120,220,255,0.35)";
  ctx.shadowBlur = 16;
  ctx.lineWidth = 4.5;
  ctx.strokeStyle = "rgba(120,220,255,0.22)";
  drawPath(); ctx.stroke();

  // CORE bright line
  ctx.shadowBlur = 0;
  ctx.lineWidth = 2.2;
  ctx.strokeStyle = "rgba(210,250,255,0.92)";
  drawPath(); ctx.stroke();

  ctx.restore();
}

function envelope(u){
  // tight ends so it fades at edges like your reference
  return Math.pow(Math.sin(Math.PI*u), 1.45);
}

function startLoop(){
  if (rafId) return;

  const loop = (now)=>{
    rafId = requestAnimationFrame(loop);

    const w = canvas.clientWidth;
    const h = canvas.clientHeight;
    ctx.clearRect(0,0,w,h);

    if (!started) return;

    const { level, treble } = readAudio();
    const t = now / 1000;

    // MORE movement:
    // baseAmp makes it move even when quiet
    // maxAmp grows with music
    const baseAmp = 10;                              // movement at silence
    const maxAmp  = 85;                              // big movement at loud
    const ampPx   = baseAmp + maxAmp * Math.pow(level, 0.85);

    // extra “electric” agitation from treble
    const electric = 0.25 + 0.85 * treble;

    const centerY = h * 0.5;
    const padX = 0;                                  // full width
    const points = 420;                              // smooth
    const dx = (w - padX*2) / (points - 1);

    // Draw a double filament
    function strand(offsetY, phase, alpha){
      ctx.save();
      ctx.globalAlpha = alpha;

      const path = ()=>{
        ctx.beginPath();
        for (let i=0;i<points;i++){
          const u = i/(points-1);
          const x = padX + i*dx;

          // Audio sample (-1..1)
          const idx = Math.floor(u * (timeData.length - 1));
          const a = (timeData[idx] - 128) / 128;

          // layered motion (stronger than before)
          const slow   = Math.sin(t*1.2 + u*10 + phase) * 0.55;
          const ripple = Math.sin(t*(3.0*electric) + u*(52*electric) + phase) * 0.35;

          // blend: audio + motion
          const y = centerY + offsetY
            + envelope(u) * ampPx * (a * (0.55 + 0.45*level) + slow*0.28 + ripple*0.22);

          if (i===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        }
      };

      strokeNeonBlue(path);
      ctx.restore();
    }

    // subtle center bloom bar
    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    ctx.globalAlpha = 0.12 + 0.22 * level;
    ctx.fillStyle = "rgba(120,220,255,0.18)";
    ctx.fillRect(0, centerY-1, w, 2);
    ctx.restore();

    strand(-4.0, 0.0, 0.90);
    strand(+4.0, 1.3, 0.78);
  };

  rafId = requestAnimationFrame(loop);
}

playBtn.addEventListener("click", async (e)=>{
  e.stopPropagation();

  setupAnalyser();
  if (audioCtx.state === "suspended") await audioCtx.resume();

  audioEl.muted = false;
  audioEl.volume = 0.35;

  if (audioEl.paused) {
    await audioEl.play();
  }

  started = true;
  overlay.classList.add("active");
  startLoop();
  playBtn.classList.add("hidden");

  resizeCanvas();
});


</script>

</body>
</html>



